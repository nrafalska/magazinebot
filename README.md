# üìñ MagazineBot MVP (Desktop InDesign)

Telegram-–±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó PDF-–∂—É—Ä–Ω–∞–ª—ñ–≤ —á–µ—Ä–µ–∑ Adobe InDesign Desktop.

## ‚ú® –©–æ –≤–º—ñ—î MVP

- üì± –ü—Ä–∏–π–º–∞—î —Ñ–æ—Ç–æ –π –∫–æ—Ä–æ—Ç–∫–∏–π –±—Ä–∏—Ñ —É Telegram
- üíæ –ó–±–µ—Ä—ñ–≥–∞—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —è–∫ `job` —É –ª–æ–∫–∞–ª—å–Ω—É –ø–∞–ø–∫—É
- üìã –ì–µ–Ω–µ—Ä—É—î `compose_plan.json` –¥–ª—è InDesign
- üñ•Ô∏è –ó–∞–ø—É—Å–∫–∞—î –ª–æ–∫–∞–ª—å–Ω–∏–π AIZINE-–ø—Ä–æ—Ü–µ—Å (`aizine_oneclick.ps1`)
- üìÑ –ü–æ–≤–µ—Ä—Ç–∞—î –≥–æ—Ç–æ–≤–∏–π PDF –∂—É—Ä–Ω–∞–ª –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –≤ Telegram

> **–£–≤–∞–≥–∞:** –í–µ—Å—å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø—ñ –∑ Adobe InDesign. –ñ–æ–¥–Ω–∏—Ö –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –ª—ñ—Ü–µ–Ω–∑—ñ–π (InDesign Server) –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ.

---

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

```
magazinebot/
‚îú‚îÄ‚îÄ bot/                      # Telegram –±–æ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ bot.py               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
‚îÇ   ‚îú‚îÄ‚îÄ handlers.py          # –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
‚îÇ   ‚îú‚îÄ‚îÄ keyboards.py         # –ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∏
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt     # –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
‚îÇ
‚îú‚îÄ‚îÄ aizine_integration/       # –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ AIZINE
‚îÇ   ‚îú‚îÄ‚îÄ build_plan.py        # job.json ‚Üí compose_plan.json
‚îÇ   ‚îî‚îÄ‚îÄ mapping_example.md   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –º–∞–ø–ø—ñ–Ω–≥—É
‚îÇ
‚îú‚îÄ‚îÄ jobs/                     # –ß–µ—Ä–≥–∞ –∑–∞–º–æ–≤–ª–µ–Ω—å
‚îÇ   ‚îî‚îÄ‚îÄ <job_id>/
‚îÇ       ‚îú‚îÄ‚îÄ input/           # –§–æ—Ç–æ –≤—ñ–¥ –∫–ª—ñ—î–Ω—Ç–∞
‚îÇ       ‚îú‚îÄ‚îÄ meta/            # job.json
‚îÇ       ‚îî‚îÄ‚îÄ output/          # PDF + –ª–æ–≥–∏
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ run_job.ps1          # –†–∞–Ω–Ω–µ—Ä –¥–ª—è –æ–∫—Ä–µ–º–æ–≥–æ job
‚îÇ   ‚îî‚îÄ‚îÄ aizine_oneclick.ps1  # –Ü—Å–Ω—É—é—á–∏–π AIZINE —Å–∫—Ä–∏–ø—Ç
‚îÇ
‚îî‚îÄ‚îÄ data/
    ‚îú‚îÄ‚îÄ templates/           # .indd/.idml —à–∞–±–ª–æ–Ω–∏
    ‚îî‚îÄ‚îÄ config/
        ‚îî‚îÄ‚îÄ templates_map.json
```

---

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### 1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

```powershell
cd C:\Projects\magazinebot

# –°—Ç–≤–æ—Ä–∏ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ
python -m venv venv
.\venv\Scripts\Activate.ps1

# –í—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
pip install -r bot\requirements.txt
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–°–∫–æ–ø—ñ—é–π `.env.example` ‚Üí `.env` —ñ –∑–∞–ø–æ–≤–Ω–∏:

```env
BOT_TOKEN=your_telegram_bot_token
ADMIN_CHAT_ID=your_telegram_id
```

### 3. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```powershell
.\venv\Scripts\Activate.ps1
python bot\bot.py
```

---

## üì± –Ø–∫ –ø—Ä–∞—Ü—é—î –±–æ—Ç

### –î–ª—è –∫–ª—ñ—î–Ω—Ç–∞

1. `/start` ‚Äî –ø–æ—á–∏–Ω–∞—î –Ω–æ–≤–∏–π –∂—É—Ä–Ω–∞–ª
2. –í–∏–±–∏—Ä–∞—î —Ç–µ–º—É (Love Story / Family / Wedding)
3. –í–∏–±–∏—Ä–∞—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç–æ—Ä—ñ–Ω–æ–∫ (12 / 16 / 20)
4. –í–≤–æ–¥–∏—Ç—å —ñ–º'—è/–Ω–∞–∑–≤—É
5. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î —Ñ–æ—Ç–æ (–¥–æ 50 —à—Ç—É–∫)
6. –ù–∞—Ç–∏—Å–∫–∞—î "–ì–æ—Ç–æ–≤–æ" ‚Üí –æ—Ç—Ä–∏–º—É—î PDF

### –î–ª—è –¥–∏–∑–∞–π–Ω–µ—Ä–∞ (–∞–¥–º—ñ–Ω–∞)

- –û—Ç—Ä–∏–º—É—î —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –Ω–æ–≤—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
- –ú–æ–∂–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å—Ç–∞—Ç—É—Å: `/status <job_id>`
- –ú–æ–∂–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏: `/retry <job_id>`

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### templates_map.json

```json
{
  "love_story": {
    "12": "love_story_12.idml",
    "16": "love_story_16.idml",
    "20": "love_story_20.idml"
  },
  "family": {
    "12": "family_12.idml",
    "16": "family_16.idml"
  }
}
```

### –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (.env)

| –ó–º—ñ–Ω–Ω–∞ | –û–ø–∏—Å |
|--------|------|
| `BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ |
| `ADMIN_CHAT_ID` | ID —á–∞—Ç—É –¥–ª—è —Å–ø–æ–≤—ñ—â–µ–Ω—å |
| `INDESIGN_PATH` | –®–ª—è—Ö –¥–æ InDesign.exe |
| `TEMPLATES_DIR` | –ü–∞–ø–∫–∞ –∑ —à–∞–±–ª–æ–Ω–∞–º–∏ |

---

## üîÑ –§–ª–æ—É –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó

```
1. –ö–ª—ñ—î–Ω—Ç –Ω–∞–¥—Å–∏–ª–∞—î —Ñ–æ—Ç–æ –≤ Telegram
         ‚Üì
2. Bot —Å—Ç–≤–æ—Ä—é—î job:
   jobs/<job_id>/input/   ‚Üê —Ñ–æ—Ç–æ
   jobs/<job_id>/meta/job.json
         ‚Üì
3. Bot –≤–∏–∫–ª–∏–∫–∞—î: scripts/run_job.ps1 -JobId <id>
         ‚Üì
4. run_job.ps1:
   a) python aizine_integration/build_plan.py
   b) .\scripts\aizine_oneclick.ps1
         ‚Üì
5. InDesign –≥–µ–Ω–µ—Ä—É—î PDF
         ‚Üì
6. PDF –∫–æ–ø—ñ—é—î—Ç—å—Å—è –≤ jobs/<job_id>/output/
         ‚Üì
7. Bot –Ω–∞–¥—Å–∏–ª–∞—î PDF –∫–ª—ñ—î–Ω—Ç—É
```

---

## üìã –§–æ—Ä–º–∞—Ç job.json

```json
{
  "job_id": "20250130_143052_abc123",
  "created_at": "2025-01-30T14:30:52",
  "status": "pending",
  
  "client": {
    "telegram_id": 123456789,
    "username": "client_name"
  },
  
  "brief": {
    "theme": "love_story",
    "pages": 16,
    "title": "Our Love Story",
    "client_name": "–ê–Ω–Ω–∞ —ñ –ú–∞–∫—Å–∏–º"
  },
  
  "photos": [
    "photo_001.jpg",
    "photo_002.jpg"
  ],
  
  "template": "love_story_16.idml"
}
```

---

## üõ†Ô∏è Troubleshooting

### –ë–æ—Ç –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î

```powershell
# –ü–µ—Ä–µ–≤—ñ—Ä —Ç–æ–∫–µ–Ω
echo $env:BOT_TOKEN

# –ü–µ—Ä–µ–≤—ñ—Ä –ª–æ–≥–∏
Get-Content .\logs\bot.log -Tail 50
```

### InDesign –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è

```powershell
# –ü–µ—Ä–µ–≤—ñ—Ä —à–ª—è—Ö
Test-Path $env:INDESIGN_PATH

# –ó–∞–ø—É—Å—Ç–∏ –≤—Ä—É—á–Ω—É
.\scripts\run_job.ps1 -JobId "test_job"
```

### PDF –Ω–µ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è

1. –ü–µ—Ä–µ–≤—ñ—Ä `jobs/<job_id>/output/compose_log.json`
2. –ü–µ—Ä–µ–≤—ñ—Ä Script Labels —É —à–∞–±–ª–æ–Ω—ñ
3. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ —à–∞–±–ª–æ–Ω —É `data/templates/`

---

## üìà Roadmap

### MVP (–∑–∞—Ä–∞–∑)
- [x] Telegram –±–æ—Ç
- [x] Job queue
- [x] Plan builder
- [x] InDesign integration
- [x] PDF delivery

### v1.1
- [ ] AI —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è —Ñ–æ—Ç–æ (CLIP)
- [ ] –ê–≤—Ç–æ–≤–∏–±—ñ—Ä –Ω–∞–π–∫—Ä–∞—â–∏—Ö —Ñ–æ—Ç–æ
- [ ] –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É

### v1.2
- [ ] AI –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–µ–∫—Å—Ç—ñ–≤
- [ ] –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- [ ] –ì–∞–ª–µ—Ä–µ—è –≥–æ—Ç–æ–≤–∏—Ö –∂—É—Ä–Ω–∞–ª—ñ–≤

---

## üìÑ –õ—ñ—Ü–µ–Ω–∑—ñ—è

MIT ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –≤—ñ–ª—å–Ω–æ.

